<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Empório Bento Mineiro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
  <style>
    :root {
      --primary: #a56347;
      --secondary: #e16438;
      --hover: #c9542e;
      --light-bg: #f7f7f7;
      --highlight: #ffe6cc;
      --text-dark: #8B4513;
      --success: #00a44f;
      --info: #007bff;
      --danger: #dc3545;
    }
    *,*::before,*::after{box-sizing:border-box}body{font-family:Poppins,sans-serif;background:var(--light-bg);margin:0;padding:0}.header-bar{background:var(--primary);color:#fff;padding:10px;display:flex;align-items:center;justify-content:space-between}.header-left{display:flex;align-items:center;gap:10px}.header-left img{max-height:50px}.header-left h2{font-size:1rem;margin:0;font-weight:500}.cart-icon{position:relative;cursor:pointer}.cart-count{position:absolute;top:-6px;right:-6px;background:var(--danger);color:#fff;font-size:.7rem;padding:2px 5px;border-radius:50%}.category-chips{display:flex;gap:10px;overflow-x:auto;padding:10px;background:#fff}.category-chip{flex:0 0 auto;background:#fff;border:1px solid #ddd;border-radius:20px;padding:8px 16px;font-weight:500;cursor:pointer;transition:background .2s;white-space:nowrap;color:var(--primary)}.category-chip:hover{background:var(--highlight)}.category-chip.active{background:var(--highlight);border-color:var(--primary)}hr.separator-chips{margin:0;border:none;border-top:1px solid #ddd}#loadingIndicator{display:none;text-align:center;margin:20px 0}.product-card{border:none;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);overflow:hidden;margin-bottom:20px;background:#fff}.product-card img{width:100%;aspect-ratio:4/1;object-fit:cover}.product-body{padding:10px;text-align:left}.product-title{font-size:.9rem;font-weight:600;margin-bottom:5px}.product-price{color:var(--text-dark);font-weight:500;margin-bottom:8px;display:flex;align-items:center;gap:6px}.product-type-label{font-size:.65rem;font-weight:500;white-space:nowrap}.product-type-label:not(.encomenda){color:var(--success)}.product-type-label.encomenda{color:var(--info)}.control-container{text-align:center}.qty-controls{display:inline-flex;align-items:center;gap:10px;margin-top:8px}.qty-btn{background:#fff;border:1px solid #ff6600;color:#ff6600;font-weight:600;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.9rem}.qty-value{min-width:20px;text-align:center;font-weight:500;font-size:.9rem}.btn-orange{background:var(--secondary);border:none;color:#fff;font-size:.8rem;padding:4px 10px;border-radius:12px;display:inline-block}.btn-orange:hover{background:var(--hover)}.modal-header,.modal-footer{border:none}.modal-body .cart-item{display:flex;justify-content:space-between;margin-bottom:10px}.modal-body .form-control{margin-bottom:10px}footer{margin-top:30px;padding:10px;text-align:center;color:#888;font-size:.9rem}@media (max-width:576px){.header-left h2{font-size:.9rem}}
  </style>
</head>
<body>
  <div class="header-bar">
    <div class="header-left">
      <img src="https://i.imgur.com/NVldFUa.png" alt="Logo Bento Mineiro">
      <h2>Seja bem vindo em nossa loja!</h2>
    </div>
    <div class="cart-icon" onclick="verCarrinho()">
      <svg width="24" height="24" fill="#fff" viewBox="0 0 24 24"><path d="M7 18a2 2 0 100 4 2 2 0 000-4zm10 0a2 2 0 100 4 2 2 0 000-4zM3.636 2l3.364 6h10.364l3-6H3.636zM2 0h20l-4 8H6L2 0z"/></svg>
      <span id="cartCount" class="cart-count">0</span>
    </div>
  </div>
  <div class="category-chips" id="chipsContainer"></div>
  <hr class="separator-chips">
  <div id="loadingIndicator">
    <div class="spinner-border" role="status"><span class="visually-hidden">Carregando...</span></div>
    <p>Carregando produtos...</p>
  </div>
  <div class="container"><div class="row" id="productsContainer"></div></div>
  <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Carrinho</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="cartItems"></div>
          <hr>
          <div class="d-flex justify-content-between"><strong>Total:</strong><span id="cartTotal">R$ 0,00</span></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-danger" onclick="limparCarrinho()">Limpar Carrinho</button>
          <button class="btn btn-success" onclick="mostrarFormularioDados()">Finalizar Pedido</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="dadosModal" tabindex="-1" aria-labelledby="dadosModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Seus Dados e Resumo do Pedido</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="formDados">
            <input type="text" class="form-control" id="nomeDados" placeholder="Nome" required>
            <input type="tel" class="form-control" id="telefoneDados" placeholder="Telefone" required>
            <input type="text" class="form-control" id="cepDados" placeholder="CEP (ex: 00000-000)" required>
            <input type="text" class="form-control" id="enderecoDados" placeholder="Endereço" required>
            <input type="text" class="form-control" id="numeroDados" placeholder="Número" required>
            <input type="text" class="form-control" id="complementoDados" placeholder="Complemento">
            <textarea class="form-control" id="observacoesDados" rows="3" placeholder="Observações"></textarea>
          </form>
          <hr>
          <div id="orderSummary"></div>
          <div id="orderTotal"></div>
          <p style="font-size:.75rem;font-style:italic;color:#555;margin-top:10px">Ao finalizar, você será encaminhado ao WhatsApp para concluir seu pedido. Prazos de entrega e valores de frete serão combinados lá.</p>
          <hr>
          <div class="mb-2">
            <input type="text" class="form-control" id="cupomDados" placeholder="Cupom de Desconto">
            <button class="btn btn-primary btn-sm mt-2" onclick="aplicarCupom()">Aplicar Cupom</button>
            <div id="cupomFeedback"></div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Voltar</button>
          <button class="btn btn-success" onclick="finalizarPedidoWhatsApp()">Finalizar Pedido</button>
        </div>
      </div>
    </div>
  </div>
  <footer>© 2025 Bento Mineiro. Todos os direitos reservados.</footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  <script>
    const API_URL="https://script.google.com/macros/s/AKfycbw8aho5WzXL8_x4ygTgu31MD9-c4xdpmfltlj61iLzHiRyxSw14GGJqWqe_Uhn9Pq7U/exec",CACHE={key:"bentoMineiroProdutos",ts:"bentoMineiroProdutosTimestamp",exp:300000},state={products:[],cart:{},user:{},category:localStorage.getItem("bentoMineiroCurrentCategory")||"Destaques",cupons:[],appliedCupom:null};function saveCart(){localStorage.setItem("bentoMineiroCart",JSON.stringify(state.cart))}function loadCart(){state.cart=JSON.parse(localStorage.getItem("bentoMineiroCart"))||{};updateCartCount()}function saveCategory(t){localStorage.setItem("bentoMineiroCurrentCategory",t)}function highlightChip(t){document.querySelectorAll(".category-chip").forEach(e=>e.textContent.trim().toLowerCase()===t.toLowerCase()?e.classList.add("active"):e.classList.remove("active"))}async function fetchCupons(){try{const t=await fetch(API_URL+"?action=cupons"),e=await t.json();if(!Array.isArray(e)||e.length<2)return[];const n=e[0];return e.slice(1).map(t=>{let e={};return n.forEach((n,r)=>e[n]=t[r]),e})}catch(t){return console.error("Erro ao buscar cupons:",t),[]}}document.addEventListener("DOMContentLoaded",async()=>{loadUserData(),loadCart(),showLoading(!0);try{const t=await fetchProductsCached();state.products=transformData(t),state.cupons=await fetchCupons(),generateChips(),filterCategory(state.category)}catch(t){console.error("Erro ao carregar produtos:",t)}finally{showLoading(!1)}document.getElementById("cepDados").addEventListener("blur",async function(){const t=this.value.replace(/\D/g,"");if(8===t.length)try{const e=await fetch(`https://viacep.com.br/ws/${t}/json/`),n=await e.json();n.erro?alert("CEP não encontrado."):document.getElementById("enderecoDados").value=`${n.logradouro}, ${n.bairro}, ${n.localidade} - ${n.uf}`}catch(t){console.error("Erro ao buscar CEP:",t)}})});function generateChips(){const t=new Set(state.products.map(t=>t.Categoria?.trim()).filter(t=>t)),e=document.getElementById("chipsContainer");e.innerHTML="";const n=["Destaques",...[...t].sort()];n.forEach(t=>{const n=document.createElement("div");n.className="category-chip",n.textContent=t,n.addEventListener("click",()=>{saveCategory(t),filterCategory(t)}),e.appendChild(n)})}async function fetchProductsCached(){const t=Date.now(),e=localStorage.getItem(CACHE.key),n=localStorage.getItem(CACHE.ts);if(e&&n&&t-n<CACHE.exp)return JSON.parse(e);const r=await fetch(API_URL+"?action=produtos"),o=await r.json();return localStorage.setItem(CACHE.key,JSON.stringify(o)),localStorage.setItem(CACHE.ts,t),o}function transformData(t){return Array.isArray(t)&&t.length>1?t.slice(1).map(e=>{let n={};return t[0].forEach((t,r)=>n[t]=e[r]),n}):[]}function renderProducts(t){const e=document.getElementById("productsContainer");e.innerHTML="",t.forEach(t=>{const n="encomenda"===t.Tipo?.toLowerCase().trim()||"encomendas"===t.Tipo?.toLowerCase().trim()?"encomenda":"",r=document.createElement("div");r.className="col-6 col-md-4 col-lg-3",r.innerHTML=`<div class="product-card p-2"><img src="${t.Imagem}" alt="${t.Nome}"><div class="product-body"><div class="product-title">${t.Nome}</div><div class="product-price">R$ ${(+t.Valor).toFixed(2)}<span class="product-type-label ${n}">${t.Tipo||""}</span></div>${state.cart[t.ID]?.quantidade>0?`<div class="control-container"><div class="qty-controls" data-id="${t.ID}"><div class="qty-btn" onclick="alterarQuantidade('${t.ID}',-1)">-</div><div class="qty-value" id="qty-${t.ID}">${state.cart[t.ID].quantidade}</div><div class="qty-btn" onclick="alterarQuantidade('${t.ID}',1)">+</div></div></div>`:`<div class="control-container"><button class="btn btn-orange btn-sm" onclick="adicionarAoCarrinho('${t.ID}')">ADICIONAR</button></div>`}</div></div>`,e.appendChild(r)})}function adicionarAoCarrinho(t){const e=state.products.find(e=>e.ID==t);e&&(state.cart[t]={produto:e,quantidade:1},saveCart(),updateCartCount(),filterCategory(state.category))}function alterarQuantidade(t,e){const n=state.cart[t]||(state.cart[t]={produto:state.products.find(e=>e.ID==t),quantidade:0});n.quantidade+=e,n.quantidade<=0&&delete state.cart[t],saveCart(),updateCartCount(),filterCategory(state.category)}function updateCartCount(){document.getElementById("cartCount").textContent=Object.values(state.cart).reduce((t,e)=>t+e.quantidade,0)}function filterCategory(t){state.category=t,highlightChip(t);const e="destaques"===t.toLowerCase().trim()?state.products.filter(t=>"sim"===t.Destaque?.toLowerCase().trim()):state.products.filter(e=>e.Categoria?.toLowerCase().trim()===t.toLowerCase().trim());renderProducts(e)}function verCarrinho(){const t=document.getElementById("cartItems"),e=document.getElementById("cartTotal");t.innerHTML="";let n=0;for(const e in state.cart){const r=state.cart[e];r.quantidade>0&&(n+=+r.produto.Valor*r.quantidade,t.innerHTML+=`<div class="cart-item"><span>${r.produto.Nome} (x${r.quantidade})</span><strong>R$ ${(+r.produto.Valor*r.quantidade).toFixed(2)}</strong></div>`)}e.textContent=`R$ ${n.toFixed(2)}`,new bootstrap.Modal(document.getElementById("cartModal")).show()}function limparCarrinho(){state.cart={},localStorage.removeItem("bentoMineiroCart"),document.getElementById("cartItems").innerHTML="",document.getElementById("cartTotal").textContent="R$ 0,00",updateCartCount(),filterCategory(state.category)}function mostrarFormularioDados(){bootstrap.Modal.getInstance(document.getElementById("cartModal")).hide();const t=["nome","telefone","cep","endereco","numero","complemento","observacoes"];t.forEach(t=>document.getElementById(t+"Dados").value=state.user[t]||""),document.getElementById("cupomDados").value="",document.getElementById("cupomFeedback").textContent="",renderOrderSummary(),new bootstrap.Modal(document.getElementById("dadosModal")).show()}function renderOrderSummary(){const t=document.getElementById("orderSummary"),e={};let n=0;for(const t in state.cart){const r=state.cart[t];if(r.quantidade>0){const t=r.produto.Categoria?.trim()||"Outros";e[t]||(e[t]=[]),e[t].push(r)}}let r="";for(const t in e){r+=`<strong>${t}</strong><br>`;let o=0;e[t].forEach(t=>{const e=+t.produto.Valor*t.quantidade;o+=e,r+=`- ${t.produto.Nome} (x${t.quantidade}) = R$ ${e.toFixed(2)}<br>`}),r+=`Subtotal ${t}: R$ ${o.toFixed(2)}<br><br>`,n+=o}r+=`<strong>Total Geral: R$ ${n.toFixed(2)}</strong>`,t.innerHTML=r,t.dataset.total=n,document.getElementById("orderTotal").textContent=""}function aplicarCupom(){const t=document.getElementById("cupomDados").value.trim().toUpperCase(),e=document.getElementById("cupomFeedback"),n=+document.getElementById("orderSummary").dataset.total||0,r=state.cupons.find(e=>e.Codigo?.toUpperCase().trim()===t);if(t&&!r)e.textContent="Cupom inválido",e.style.color="#d9534f",state.appliedCupom=null;else if(r){let t=0;r.ProdutoID?.trim()?Object.entries(state.cart).forEach(([e,n])=>{e===r.ProdutoID.trim()&&(t+=calcDiscount(r.Desconto,+n.produto.Valor*n.quantidade),state.appliedCupom={cupom:r.Codigo,desconto:t,tipo:"especifico"},e.textContent=`Cupom ${r.Codigo} aplicado para produto específico! Desconto: R$ ${t.toFixed(2)}`,e.style.color="#28a745")})||0===t&&(e.textContent="Cupom específico não se aplica a nenhum item do seu pedido.",e.style.color="#d9534f",state.appliedCupom=null):(t=calcDiscount(r.Desconto,n),state.appliedCupom={cupom:r.Codigo,desconto:t,tipo:"geral"},e.textContent=`Cupom ${r.Codigo} aplicado! Desconto: R$ ${t.toFixed(2)}`,e.style.color="#28a745"),t>0&&document.getElementById("orderTotal").innerHTML=`<strong>Total com Desconto: R$ ${(n-t).toFixed(2)}</strong>`}else e.textContent="",state.appliedCupom=null}function finalizarPedidoWhatsApp(){const t=["nome","telefone","cep","endereco","numero","complemento","observacoes"];t.forEach(t=>state.user[t]=document.getElementById(t+"Dados").value),saveUserData();const e=+document.getElementById("orderSummary").dataset.total||0,n=state.appliedCupom?.desconto||0,r=e-n;let o="*Pedido Bento Mineiro*\n\n";o+=t.map(t=>`*${t.charAt(0).toUpperCase()+t.slice(1)}:* ${state.user[t]}`).join("\n")+"\n\n";const a={};for(const t in state.cart){const e=state.cart[t];if(e.quantidade>0){const t=e.produto.Categoria?.trim()||"Outros";a[t]||(a[t]=[]),a[t].push(e)}}for(const t in a){o+=`*${t}*\n`;let e=0;a[t].forEach(n=>{const r=+n.produto.Valor*n.quantidade;e+=r,o+=`- ${n.produto.Nome} (x${n.quantidade}) = R$ ${r.toFixed(2)}\n`}),["encomenda","encomendas"].includes(t.toLowerCase())&&(o+="_(Consulte a agenda de entrega de encomendas na hora de finalizar o pagamento)_\n"),o+=`Subtotal ${t}: R$ ${e.toFixed(2)}\n\n`}state.appliedCupom&&(o+=`*Cupom ${state.appliedCupom.cupom} aplicado: -R$ ${state.appliedCupom.desconto.toFixed(2)}*\n\n`),o+=`*Total Geral:* R$ ${r.toFixed(2)}\n\n***_O Bento Mineiro agradece seu contato UAI! Você vai ser atendido em breve e vamos combinar direitinho a entrega e o pagamento pra concluir seu pedido!_***\n`,window.open("https://wa.me/5511917420830?text="+encodeURIComponent(o),"_blank")}function calcDiscount(t,e){const n=t.trim();return n.includes("%")?e*(parseFloat(n.replace("%",""))/100):e*+n}function saveUserData(){localStorage.setItem("bentoMineiroUserData",JSON.stringify(state.user))}function loadUserData(){state.user=JSON.parse(localStorage.getItem("bentoMineiroUserData"))||{}}function showLoading(t){document.getElementById("loadingIndicator").style.display=t?"block":"none"}
  </script>
</body>
</html>