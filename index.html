<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Bento Mineiro - Nova Loja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts e Bootstrap CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f7f7f7;
      margin: 0; padding: 0;
    }
    /* Header / Navbar Superior */
    .header-top {
      background-color: #a56347; /* Cor de fundo da marca */
      color: #fff;
      padding: 15px 0;
      text-align: center;
      position: relative;
    }
    .header-top img.logo {
      max-height: 60px;
    }
    .header-top h1 {
      font-size: 1.2rem;
      margin: 5px 0 0 0;
    }
    /* Navbar (categorias) */
    .navbar-categories {
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .navbar-toggler {
      border: none;
    }
    .navbar-nav .nav-link {
      color: #a56347 !important;
      font-weight: 500;
    }
    .navbar-collapse.show .nav-link {
      cursor: pointer;
    }
    /* Chips de categoria */
    .category-chips {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px;
    }
    .category-chip {
      flex: 0 0 auto;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 20px;
      padding: 8px 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      white-space: nowrap;
    }
    .category-chip:hover {
      background-color: #ffe6cc;
    }
    /* Destaques */
    .destaques-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 20px 0 10px;
    }
    /* Cards de produto */
    .product-card {
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 20px;
      background-color: #fff;
    }
    .product-card img {
      width: 100%;
      aspect-ratio: 4 / 1;
      object-fit: cover;
    }
    .product-body {
      padding: 10px;
    }
    .product-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .product-price {
      color: #8B4513;
      font-weight: 500;
      margin-bottom: 8px;
    }
    .btn-add {
      background-color: #ff6600;
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 20px;
      padding: 8px 16px;
    }
    .btn-add:hover {
      background-color: #e65c00;
    }
    /* Loading Indicator */
    #loadingIndicator {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    /* Rodapé */
    footer {
      margin-top: 30px;
      padding: 10px;
      text-align: center;
      color: #888;
      font-size: 0.9rem;
    }
    /* Carrinho flutuante ou algo do tipo - se quiser */
    /* Responsividade */
    @media (max-width: 576px) {
      .header-top h1 {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>

<!-- Header Superior com Logo e Nome -->
<div class="header-top">
  <img src="https://i.imgur.com/NVldFUa.png" alt="Logo Bento Mineiro" class="logo mb-2">
  <h1>Bento Mineiro</h1>
</div>

<!-- Navbar de Categorias (Bootstrap) -->
<nav class="navbar navbar-expand-lg navbar-categories">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCategories">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCategories">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item me-3">
          <a class="nav-link" onclick="collapseNavbar(); exibirTodosProdutos()">Todos</a>
        </li>
        <li class="nav-item me-3">
          <a class="nav-link" onclick="collapseNavbar(); filtrarPorCategoria('Pronta Entrega')">Pronta Entrega</a>
        </li>
        <li class="nav-item me-3">
          <a class="nav-link" onclick="collapseNavbar(); filtrarPorCategoria('Encomendas')">Encomendas</a>
        </li>
        <li class="nav-item me-3">
          <a class="nav-link" onclick="collapseNavbar(); filtrarPorCategoria('Produtos Especiais - Queijos Premiados Boníssimo')">
            Produtos Especiais
          </a>
        </li>
        <!-- Adicione outras categorias fixas se desejar -->
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item me-3">
          <a class="nav-link" onclick="collapseNavbar(); finalizarPedidoWhatsApp()">Finalizar no WhatsApp</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Indicador de Carregamento -->
<div id="loadingIndicator">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>
  <p>Carregando produtos...</p>
</div>

<!-- Destaques -->
<div class="container">
  <div class="destaques-title">Destaques</div>
  <div class="row" id="destaquesContainer">
    <!-- Cards de destaque -->
  </div>
</div>

<!-- Lista Geral de Produtos -->
<div class="container">
  <div class="row mt-4" id="productsContainer">
    <!-- Cards de produto geral -->
  </div>
</div>

<footer>
  <p>&copy; 2025 Bento Mineiro. Todos os direitos reservados.</p>
</footer>

<!-- Bootstrap JS (Bundle com Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ==============================================
   CONFIGURAÇÕES E VARIÁVEIS GLOBAIS
============================================== */
const API_BASE_URL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // Substitua pela sua URL real
const CACHE_KEY = "bentoMineiroProdutos";
const CACHE_TIMESTAMP_KEY = "bentoMineiroProdutosTimestamp";
const CACHE_EXPIRATION = 10 * 60 * 1000; // 10 minutos de cache

let allProducts = []; // Armazena todos os produtos
let cart = {};        // Armazena itens do carrinho

/* ==============================================
   FUNÇÕES DE CACHE E BUSCA DE PRODUTOS
============================================== */
async function fetchProdutosCache() {
  const now = Date.now();
  const cachedData = localStorage.getItem(CACHE_KEY);
  const cachedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);
  if (cachedData && cachedTimestamp && (now - cachedTimestamp < CACHE_EXPIRATION)) {
    return JSON.parse(cachedData);
  } else {
    const response = await fetch(API_BASE_URL + "?type=produtos");
    const produtos = await response.json();
    localStorage.setItem(CACHE_KEY, JSON.stringify(produtos));
    localStorage.setItem(CACHE_TIMESTAMP_KEY, now);
    return produtos;
  }
}

/* ==============================================
   INICIALIZAÇÃO
============================================== */
document.addEventListener("DOMContentLoaded", async () => {
  mostrarCarregando(true);
  try {
    allProducts = await fetchProdutosCache();
    exibirDestaques(allProducts);
    exibirProdutos(allProducts, "productsContainer"); // Exibe todos inicialmente
  } catch (error) {
    console.error("Erro ao carregar produtos:", error);
  } finally {
    mostrarCarregando(false);
  }
});

/* ==============================================
   FUNÇÕES DE LAYOUT
============================================== */
function mostrarCarregando(status) {
  document.getElementById("loadingIndicator").style.display = status ? "block" : "none";
}

function collapseNavbar() {
  const navbar = document.getElementById("navbarCategories");
  const bsCollapse = new bootstrap.Collapse(navbar, {toggle: false});
  bsCollapse.hide();
}

/* ==============================================
   EXIBIR DESTAQUES
============================================== */
function exibirDestaques(produtos) {
  const container = document.getElementById("destaquesContainer");
  container.innerHTML = "";
  // Exemplo: filtra produtos que tenham uma propriedade "Destaque" = true
  // Ou simplesmente pega os 4 primeiros
  const destaques = produtos.filter(p => p.Destaque === true).slice(0,4);
  // Se não achar, pode pegar os 4 primeiros
  if (destaques.length === 0) {
    // fallback
    destaques.push(...produtos.slice(0,4));
  }
  destaques.forEach(prod => {
    const col = document.createElement("div");
    col.className = "col-6 col-md-3";
    col.innerHTML = `
      <div class="product-card">
        <img src="${prod.Imagem}" alt="${prod.Nome}">
        <div class="product-body">
          <div class="product-title">${prod.Nome}</div>
          <div class="product-price">R$ ${parseFloat(prod.Valor).toFixed(2)}</div>
          <button class="btn-add" data-id="${prod.ID}">Adicionar</button>
        </div>
      </div>
    `;
    container.appendChild(col);
  });
  // Evento de adicionar
  const addBtns = container.querySelectorAll(".btn-add");
  addBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-id");
      adicionarAoCarrinho(id);
    });
  });
}

/* ==============================================
   EXIBIR PRODUTOS GERAIS
============================================== */
function exibirProdutos(produtos, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";
  produtos.forEach(prod => {
    const col = document.createElement("div");
    col.className = "col-6 col-md-4 col-lg-3";
    col.innerHTML = `
      <div class="product-card">
        <img src="${prod.Imagem}" alt="${prod.Nome}">
        <div class="product-body">
          <div class="product-title">${prod.Nome}</div>
          <div class="product-price">R$ ${parseFloat(prod.Valor).toFixed(2)}</div>
          <button class="btn-add" data-id="${prod.ID}">Adicionar</button>
        </div>
      </div>
    `;
    container.appendChild(col);
  });
  // Evento de adicionar
  const addBtns = container.querySelectorAll(".btn-add");
  addBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-id");
      adicionarAoCarrinho(id);
    });
  });
}

/* ==============================================
   FILTRAR POR CATEGORIA
============================================== */
function filtrarPorCategoria(catName) {
  const filtrados = allProducts.filter(p => p.Categoria === catName);
  exibirProdutos(filtrados, "productsContainer");
}

/* ==============================================
   EXIBIR TODOS OS PRODUTOS
============================================== */
function exibirTodosProdutos() {
  exibirProdutos(allProducts, "productsContainer");
}

/* ==============================================
   FUNÇÕES DE CARRINHO
============================================== */
function adicionarAoCarrinho(productID) {
  const produto = allProducts.find(p => p.ID == productID);
  if (!produto) return;
  if (!cart[productID]) {
    cart[productID] = { produto, quantidade: 0 };
  }
  cart[productID].quantidade += 1;
  alert(`Adicionado: ${produto.Nome}`);
  console.log("Carrinho:", cart);
}

/* ==============================================
   FINALIZAR PEDIDO VIA WHATSAPP
============================================== */
function finalizarPedidoWhatsApp() {
  // Monta a mensagem com base no cart
  let mensagem = "*Pedido Bento Mineiro*\n\n";
  let total = 0;
  for (const pid in cart) {
    const item = cart[pid];
    if (item.quantidade > 0) {
      mensagem += `- ${item.produto.Nome} (x${item.quantidade})\n`;
      total += parseFloat(item.produto.Valor) * item.quantidade;
    }
  }
  mensagem += `\nTotal: R$ ${total.toFixed(2)}\n\n`;
  mensagem += "Endereço / Observações:\n";
  // Abre o WhatsApp
  const url = "https://wa.me/5511984193457?text=" + encodeURIComponent(mensagem);
  window.open(url, "_blank");
}
</script>

</body>
</html>