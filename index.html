<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Bento Mineiro - Nova Loja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts e Bootstrap CSS -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f7f7f7;
      margin: 0; 
      padding: 0;
    }
    .header-bar {
      background-color: #a56347;
      color: #fff;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-left img {
      max-height: 50px;
    }
    .header-left h2 {
      font-size: 1rem;
      margin: 0;
      font-weight: 500;
    }
    .category-chips {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding: 10px;
      background-color: #fff;
    }
    .category-chip {
      flex: 0 0 auto;
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 20px;
      padding: 8px 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      white-space: nowrap;
      color: #a56347;
    }
    .category-chip:hover {
      background-color: #ffe6cc;
    }
    #loadingIndicator {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    .product-card {
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 20px;
      background-color: #fff;
    }
    .product-card img {
      width: 100%;
      aspect-ratio: 4 / 1;
      object-fit: cover;
    }
    .product-body {
      padding: 10px;
    }
    .product-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 5px;
    }
    .product-price {
      color: #8B4513;
      font-weight: 500;
      margin-bottom: 8px;
    }
    footer {
      margin-top: 30px;
      padding: 10px;
      text-align: center;
      color: #888;
      font-size: 0.9rem;
    }
    @media (max-width: 576px) {
      .header-left h2 { font-size: 0.9rem; }
    }
  </style>
</head>
<body>

<!-- Header -->
<div class="header-bar">
  <div class="header-left">
    <img src="https://i.imgur.com/NVldFUa.png" alt="Logo Bento Mineiro">
    <h2>Seja bem vindo em nossa loja!</h2>
  </div>
</div>

<!-- Chips de Categoria -->
<div class="category-chips">
  <div class="category-chip" onclick="filtrarCategoria('Destaques')">Destaques</div>
  <div class="category-chip" onclick="filtrarCategoria('Queijos')">Queijos</div>
  <div class="category-chip" onclick="filtrarCategoria('Doces')">Doces</div>
  <div class="category-chip" onclick="filtrarCategoria('Café da Tarde')">Café da Tarde</div>
  <div class="category-chip" onclick="filtrarCategoria('Outros')">Outros</div>
</div>

<!-- Indicador de Carregamento -->
<div id="loadingIndicator">
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>
  <p>Carregando produtos...</p>
</div>

<!-- Lista de Produtos -->
<div class="container">
  <div class="row" id="productsContainer">
    <!-- Cards de produto gerados dinamicamente -->
  </div>
</div>

<footer>
  &copy; 2025 Bento Mineiro. Todos os direitos reservados.
</footer>

<!-- Bootstrap JS (Bundle com Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const API_BASE_URL = "https://script.google.com/macros/s/AKfycbzyuFcVWYK1-wByJd1sogjCIyv_VYeN65EH1LT9-fbPef3dFY65C0-0v3AJSiIMLTErgQ/exec";
  
  let allProducts = [];

  document.addEventListener("DOMContentLoaded", async () => {
    mostrarCarregando(true);
    try {
      const data = await fetchProdutos();
      allProducts = transformarDados(data);
      filtrarCategoria("Destaques");
    } catch (error) {
      console.error("Erro ao carregar produtos:", error);
    } finally {
      mostrarCarregando(false);
    }
  });

  async function fetchProdutos() {
    const response = await fetch(API_BASE_URL + "?action=produtos");
    return await response.json();
  }

  function transformarDados(data) {
    if (!Array.isArray(data) || data.length < 2) return [];
    const headers = data[0];
    return data.slice(1).map(row => {
      let obj = {};
      headers.forEach((header, index) => { obj[header] = row[index]; });
      return obj;
    });
  }

  function filtrarCategoria(cat) {
    if (cat === "Destaques") {
      const categoriasPrincipais = ["Queijos", "Doces", "Café da Tarde", "Outros"];
      let destaques = [];
      categoriasPrincipais.forEach(c => {
        const found = allProducts.find(p => p.Categoria === c);
        if (found) destaques.push(found);
      });
      exibirProdutos(destaques);
    } else {
      const filtrados = allProducts.filter(p => p.Categoria === cat);
      exibirProdutos(filtrados);
    }
  }

  function exibirProdutos(produtos) {
    const container = document.getElementById("productsContainer");
    container.innerHTML = "";
    produtos.forEach(prod => {
      const col = document.createElement("div");
      col.className = "col-6 col-md-4 col-lg-3";
      col.innerHTML = `
        <div class="product-card p-2">
          <img src="${prod.Imagem}" alt="${prod.Nome}">
          <div class="product-body">
            <div class="product-title">${prod.Nome}</div>
            <div class="product-price">R$ ${parseFloat(prod.Valor || 0).toFixed(2)}</div>
          </div>
        </div>
      `;
      container.appendChild(col);
    });
  }

  function mostrarCarregando(status) {
    document.getElementById("loadingIndicator").style.display = status ? "block" : "none";
  }
</script>
</body>
</html>